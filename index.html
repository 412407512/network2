<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>شبكة على كيفك | الرئيسية</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <script src="config.js"></script>
</head>

<body>

    <div class="header-wave">
        <div id="slider-box" style="text-align: center; margin-bottom: 10px; min-height: 60px;">
            <h2 id="slide-title" style="margin:0; transition: 0.5s;">على كيفك</h2>
            <p id="slide-desc" style="font-size: 12px; opacity: 0.8; transition: 0.5s;">أهلاً بك في عالم السرعة</p>
        </div>
        <div class="logo-container">
            <img src="IMG_3797.png" alt="Logo" onerror="this.src='IMG_3797.jpg'">
        </div>
    </div>

    <div class="main-content">
        <div id="login-section" class="page active">

            <div id="auth-box">
                <div class="glass-card animate-up">
                    <form id="auth-form" action="$(link-login-only)" method="post"
                        onsubmit="return startLoginProcess();">
                        <input type="hidden" name="dst" value="$(link-orig)" />
                        <input type="hidden" name="popup" value="true" />

                        <div class="input-group">
                            <i class="fas fa-user icon-inside"></i>
                            <input type="number" id="user-field" name="username" placeholder="أدخل رقم الكرت" required
                                autofocus>
                        </div>
                        <div class="input-group">
                            <i class="fas fa-lock icon-inside"></i>
                            <input type="password" id="pass-field" name="password" placeholder="كلمة المرور">
                        </div>

                        <button type="submit" class="btn-primary" id="login-btn">
                            <span>اتصل الآن</span>
                            <i class="fas fa-bolt"></i>
                        </button>
                    </form>
                </div>

                <!-- $(if error)
                <div class="glass-card animate-up" style="border: 1px solid #fee2e2; background: #fef2f2; color: #991b1b; padding: 12px; text-align: center; font-size: 13px; margin-top: 15px;">
                    <i class="fas fa-exclamation-circle"></i> $(error)
                </div>
                $(endif) -->

                <div id="last-card-area" class="glass-card animate-up"
                    style="display:none; text-align:center; border-top: 3px solid var(--accent-color); margin-top:20px;">
                    <p style="font-size:12px; color:var(--text-light)">هل تريد استخدام كرتك الأخير؟</p>
                    <div id="last-val"
                        style="font-weight:bold; font-size: 18px; margin-bottom:10px; color: var(--text-dark);"></div>
                    <button onclick="quickConnect()" class="btn-secondary">دخول سريع</button>
                </div>
            </div>

            <div id="status-box" style="display: none;">
                <div class="glass-card success-card animate-up">
                    <div class="success-icon"><i class="fas fa-check"></i></div>
                    <h2 style="color: #166534; margin: 0;">تم الاتصال بنجاح!</h2>
                    <p style="color: var(--text-light); font-size: 13px;">مرحباً بك مجدداً في شبكة على كيفك</p>

                    <div
                        style="background: #f0fdf4; padding: 15px; border-radius: 15px; margin: 20px 0; border: 1px solid #dcfce7;">
                        <span style="display: block; font-size: 11px; color: #16a34a; margin-bottom: 5px;">اسم المستخدم
                            المتصل</span>
                        <span id="connected-user"
                            style="font-size: 20px; font-weight: bold; color: #15803d;">$(username)</span>
                    </div>

                    <form action="$(link-logout)" name="logout">
                        <button type="submit" class="logout-btn">
                            <i class="fas fa-sign-out-alt"></i> تسجيل الخروج
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <div id="plans-section" class="page" style="display:none">
            <h3 class="section-title"><i class="fas fa-shopping-cart"></i> باقات الانترنت</h3>
            <div id="plans-grid" class="grid-list"></div>
        </div>

        <div id="resellers-section" class="page" style="display:none">
            <h3 class="section-title"><i class="fas fa-store"></i> نقاط البيع والموزعين</h3>
            <div id="resellers-grid" class="grid-list"></div>
        </div>
        <div id="support-section" class="page" style="display:none">
            <h3 class="section-title"><i class="fas fa-headset"></i> الدعم الفني</h3>

            <div class="glass-card animate-up" style="text-align: center; padding: 30px 20px;">
                <p style="color: var(--text-light); font-size: 14px; margin-bottom: 25px;">نحن هنا لمساعدتك، يمكنك
                    التواصل معنا عبر الوسائل التالية:</p>

                <div class="support-grid">
                    <a href="https://wa.me/970594870519" class="support-card whatsapp">
                        <i class="fab fa-whatsapp"></i>
                        <span>واتساب</span>
                    </a>

                    <a href="tel:0593020672" class="support-card phone">
                        <i class="fas fa-phone-alt"></i>
                        <span>اتصال هاتي</span>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <nav class="bottom-nav">
        <a href="javascript:void(0)" class="nav-item active" onclick="showTab('login-section', this)">
            <i class="fas fa-home"></i> <span>الرئيسية</span>
        </a>
        <a href="javascript:void(0)" class="nav-item" onclick="showTab('plans-section', this)">
            <i class="fas fa-wifi"></i> <span>الباقات</span>
        </a>
        <a href="javascript:void(0)" class="nav-item" onclick="showTab('resellers-section', this)">
            <i class="fas fa-map-marked-alt"></i> <span>الموزعين</span>
        </a>
        <a href="javascript:void(0)" class="nav-item" onclick="showTab('support-section', this)">
            <i class="fas fa-headset"></i> <span>الدعم</span>
        </a>

    </nav>

    <div id="loader" class="loader-overlay">
        <div class="spinner"></div>
        <p style="margin-top: 15px; font-weight: bold; color: var(--text-dark);">جاري التحقق من البيانات...</p>
    </div>

    <script>
        // --- 1. التنقل بين التبويبات ---
        function showTab(id, el) {
            document.querySelectorAll('.page').forEach(p => {
                p.style.display = 'none';
                p.classList.remove('active');
            });
            const target = document.getElementById(id);
            target.style.display = 'block';
            setTimeout(() => target.classList.add('active'), 10);

            if (el) {
                document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                el.classList.add('active');
            }
        }

        // --- 2. إدارة تسجيل الدخول ---
        function startLoginProcess() {
            const u = document.getElementById('user-field').value;
            const btn = document.getElementById('login-btn');

            if (u.trim() === "") return false;

            // أنيميشن الزر واللودر
            btn.classList.add('loading');
            document.getElementById('loader').style.display = 'flex';

            localStorage.setItem('saved_u', u);
            localStorage.setItem('saved_p', document.getElementById('pass-field').value);

            setTimeout(() => {
                document.getElementById('auth-form').submit();
            }, 1000);

            return false;
        }

        function quickConnect() {
            document.getElementById('user-field').value = localStorage.getItem('saved_u');
            document.getElementById('pass-field').value = localStorage.getItem('saved_p') || "";
            startLoginProcess();
        }

        // --- 3. فحص حالة المستخدم (متصل أم لا) ---
        function checkSystemState() {
            const currentUser = "$(username)";
            const authBox = document.getElementById('auth-box');
            const statusBox = document.getElementById('status-box');

            // وسم مايكروتك يرجع اسم المستخدم إذا كان متصلاً
            if (currentUser && currentUser !== "" && currentUser !== "unknown" && currentUser !== "$(username)") {
                authBox.style.display = 'none';
                statusBox.style.display = 'block';
                document.getElementById('connected-user').innerText = currentUser;
            } else {
                authBox.style.display = 'block';
                statusBox.style.display = 'none';

                const savedU = localStorage.getItem('saved_u');
                if (savedU) {
                    document.getElementById('last-card-area').style.display = 'block';
                    document.getElementById('last-val').innerText = savedU;
                }
            }
        }

        // --- 4. السلايدر ---
        function startSlider() {
            if (!window.SamiConfig || !SamiConfig.slider || SamiConfig.slider.length === 0) return;
            let i = 0;
            const titleEl = document.getElementById('slide-title');
            const descEl = document.getElementById('slide-desc');

            setInterval(() => {
                i = (i + 1) % SamiConfig.slider.length;
                titleEl.style.opacity = 0;
                descEl.style.opacity = 0;
                setTimeout(() => {
                    titleEl.innerText = SamiConfig.slider[i].title;
                    descEl.innerText = SamiConfig.slider[i].desc;
                    titleEl.style.opacity = 1;
                    descEl.style.opacity = 1;
                }, 500);
            }, 4000);
        }

        // --- 5. تحميل البيانات من config.js ---
        function loadData() {
            if (!window.SamiConfig) return;

            // الباقات
            if (SamiConfig.plans) {
                document.getElementById('plans-grid').innerHTML = SamiConfig.plans.map(p => `
                    <div class="item-row animate-up">
                        <div class="item-info">
                            <div class="item-name">${p.name}</div>
                            <div class="item-desc">${p.info}</div>
                        </div>
                        <div class="price-pill">${p.price}</div>
                    </div>
                `).join('');
            }

            // الموزعين
            if (SamiConfig.resellers) {
                document.getElementById('resellers-grid').innerHTML = SamiConfig.resellers.map(r => `
                    <div class="item-row animate-up">
                        <div class="item-info">
                            <div class="item-name">${r.name}</div>
                            <div class="item-desc"><i class="fas fa-map-marker-alt"></i> ${r.address}</div>
                        </div>
                        ${r.phone ? `<a href="tel:${r.phone}" class="call-btn"><i class="fas fa-phone"></i></a>` : ''}
                    </div>
                `).join('');
            }
            // داخل دالة window.onload أو loadData
            if (SamiConfig.support) {
                const whatsappLink = document.querySelector('.support-card.whatsapp');
                const phoneLink = document.querySelector('.support-card.phone');

                if (whatsappLink) whatsappLink.href = SamiConfig.support.whatsapp || "#";
                if (phoneLink) phoneLink.href = "tel:" + SamiConfig.support.phone;
            }
        }

        // تشغيل كل شيء عند التحميل
        window.onload = function () {
            startSlider();
            checkSystemState();
            loadData();
        };
    </script>
</body>

</html>